import React, { useState, useRef } from 'react';

const questions = [
  {
    question: "When working in a group project, you usually:",
    options: {
      A: "Handle the planning and make sense of numbers",
      B: "Design the presentation and think of catchy ideas",
      C: "Make sure everyone is heard and things are fair",
      D: "Come up with creative but logical solutions"
    }
  },
  {
    question: "Which of these sounds most fun to you?",
    options: {
      A: "Tracking your spending and saving using a money app",
      B: "Making Instagram reels or designing posters",
      C: "Leading a campaign about sustainability in your school",
      D: "Solving puzzles, patterns, or Sudoku"
    }
  },
  {
    question: "Imagine your dream job â€” which sounds most like you?",
    options: {
      A: "Helping a company earn more money wisely",
      B: "Creating cool ads that go viral",
      C: "Making businesses more eco-friendly and ethical",
      D: "Analyzing data to make smart decisions"
    }
  },
  {
    question: "Whatâ€™s your favorite type of subject?",
    options: {
      A: "Business, accounts, or economics",
      B: "English, art, or media",
      C: "Sociology, psychology, or environment",
      D: "Math, computers, or science"
    }
  },
  {
    question: "If you had â‚¹1,00,000 to start something, what would you do?",
    options: {
      A: "Invest in stocks or start a small finance business",
      B: "Start a YouTube or online clothing brand",
      C: "Fund a cause you care about and make it public",
      D: "Build a tech-based app or online tool"
    }
  },
  {
    question: "Whatâ€™s your dream work vibe?",
    options: {
      A: "Suited up, in a business meeting",
      B: "Casual wear, creating content",
      C: "In nature or working on real-world problems",
      D: "Laptop + headphones, solving things in peace"
    }
  },
  {
    question: "Your teachers often say you are:",
    options: {
      A: "Smart with numbers",
      B: "Imaginative and expressive",
      C: "Honest and kind",
      D: "Curious and logical"
    }
  },
  {
    question: "What would you do after seeing a business fail?",
    options: {
      A: "Analyze the financial mistakes",
      B: "Redesign their branding and story",
      C: "Check if they were harming society",
      D: "Use data to understand what went wrong"
    }
  },
  {
    question: "Which headline grabs your attention?",
    options: {
      A: "Teen Invests â‚¹5000, Grows to â‚¹50,000!",
      B: "How One Reels Trend Made This Brand Famous",
      C: "This Start-up Plants Trees for Every Sale",
      D: "AI Predicts What Youâ€™ll Buy Next"
    }
  },
  {
    question: "What would you love to learn more about?",
    options: {
      A: "How businesses earn, grow, and manage money",
      B: "How to build a personal brand or run campaigns",
      C: "How companies can care for people & the planet",
      D: "How AI, numbers, and tech power smart business"
    }
  },
  {
    question: "True or False: I enjoy calculating profits and taxes.",
    options: {
      A: "True",
      B: "False"
    }
  },
  {
    question: "Slider: Rate your interest in designing (0 = not at all, 10 = love it)",
    type: "slider",
    key: "B"
  },
  {
    question: "True or False: Ethics are more important than profits.",
    options: {
      C: "True",
      A: "False"
    }
  },
  {
    question: "Slider: How much do you enjoy working with data (0 = not at all, 10 = love it)?",
    type: "slider",
    key: "D"
  },
  {
    question: "True or False: I like following trends and making viral content.",
    options: {
      B: "True",
      C: "False"
    }
  }
];

const results = {
  A: {
    title: "Finance Wizard ğŸ§®",
    description: "Youâ€™re the kind of person who understands money talks and balance sheets like poetry. Youâ€™d thrive in the world of finance, where logic meets leadership!",
    roles: ["Financial Analyst", "Investment Banker", "Chartered Accountant", "FinTech Consultant"],
    salary: "â‚¹4â€“12 LPA (Average)",
    citation: "Source: National Stock Exchange of India",
    link: "https://www.nseindia.com/"
  },
  B: {
    title: "Creative Marketer ğŸ¨",
    description: "Youâ€™ve got the vibe, the voice, and the vision! You shine in storytelling, trends, and turning brands into blockbusters.",
    roles: ["Digital Marketer", "Brand Strategist", "Content Creator"],
    salary: "â‚¹3â€“8 LPA (Average)",
    citation: "Source: UpGrad India",
    link: "https://www.upgrad.com/blog/digital-marketing-salary-in-india"
  },
  C: {
    title: "Ethical Leader ğŸŒ±",
    description: "You care deeply about impact and ethics. Youâ€™re born to lead purpose-driven organizations and shape sustainable business futures.",
    roles: ["ESG Analyst", "CSR Officer", "Sustainability Consultant"],
    salary: "â‚¹5â€“10 LPA (Average)",
    citation: "Source: Zell Education India",
    link: "https://www.zelleducation.com/blog/what-salaries-and-job-roles-can-i-expect-in-esg"
  },
  D: {
    title: "Data-Driven Thinker ğŸ§ ",
    description: "You love solving puzzles and uncovering truths through tech and numbers. The future of commerce needs minds like yours!",
    roles: ["Business Analyst", "Data Analyst", "Tech-Savvy Accountant"],
    salary: "â‚¹6â€“14 LPA (Average)",
    citation: "Source: Indeed India",
    link: "https://in.indeed.com/career/business-analyst/salaries"
  }
};

export default function CommerceCareerQuiz() {
  const [answers, setAnswers] = useState([]);
  const [showResult, setShowResult] = useState(false);

  const handleAnswer = (option, sliderKey = null) => {
    if (sliderKey) setAnswers([...answers, sliderKey]);
    else setAnswers([...answers, option]);
    if (answers.length + 1 === questions.length) setShowResult(true);
  };

  const calculateResult = () => {
    const tally = { A: 0, B: 0, C: 0, D: 0 };
    answers.forEach(ans => {
      if (tally[ans] !== undefined) tally[ans]++;
    });
    return Object.entries(tally)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 2);
  };

  const shareToSocial = () => {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent("Check out my Commerce Career Quiz result!");
    const shareUrl = `https://wa.me/?text=${text}%20${url}`;
    window.open(shareUrl, '_blank');
  };

  if (showResult) {
    const topResults = calculateResult();
    return (
      <div className="p-6 max-w-xl mx-auto text-center">
        <h2 className="text-2xl font-bold mb-4">ğŸ‰ Your Top Career Matches</h2>
        {topResults.map(([key], i) => (
          <div key={key} className="bg-white shadow-md rounded-xl p-4 mb-4">
            <h3 className="text-xl font-semibold">#{i + 1}: {results[key].title}</h3>
            <p className="italic">{results[key].description}</p>
            <p>ğŸŒŸ Roles: {results[key].roles.join(", ")}</p>
            <p>ğŸ’° Salary: {results[key].salary}</p>
            <p>ğŸ“š {results[key].citation}</p>
            <a className="text-blue-500 underline" href={results[key].link} target="_blank" rel="noopener noreferrer">ğŸ”— Learn More</a>
          </div>
        ))}
        <div className="space-y-2">
          <button className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600" onClick={() => { setAnswers([]); setShowResult(false); }}>ğŸ” Retake Quiz</button>
          <button className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600" onClick={shareToSocial}>ğŸ“² Share on WhatsApp</button>
        </div>
      </div>
    );
  }

  const current = questions[answers.length];
  return (
    <div className="p-6 max-w-xl mx-auto">
      <h1 className="text-2xl font-bold mb-4">ğŸŒŸ Commerce Career Fit Quiz</h1>
      <p className="mb-4">Question {answers.length + 1} of {questions.length}</p>
      <div className="mb-4">
        <h2 className="text-lg font-semibold mb-2">{current.question}</h2>
        {current.type === 'slider' ? (
          <div>
            <input
              type="range"
              min="0"
              max="10"
              defaultValue="5"
              className="w-full"
              onMouseUp={() => handleAnswer(current.key, current.key)}
            />
            <div className="text-sm text-gray-500">Drag the slider and release to answer</div>
          </div>
        ) : (
          Object.entries(current.options).map(([key, text]) => (
            <button
              key={key}
              onClick={() => handleAnswer(key)}
              className="block w-full text-left bg-gray-100 hover:bg-gray-200 rounded p-3 mb-2"
            >
              {text}
            </button>
          ))
        )}
      </div>
    </div>
  );
}
